{"version":3,"file":"index.modern.js","sources":["../src/index.js"],"sourcesContent":["import React, { useReducer, useCallback } from 'react'\n\nconst getInitialState = initialValues => {\n  return {\n    values: {\n      ...initialValues\n    },\n    errors: {}, // all errors\n    touched: {}, // dirty field names\n    isSubmitted: false, //is form submitted to check validation\n    submitCounter: 0\n  }\n}\n\nconst reducer = (state, { type, payload }) => {\n  switch (type) {\n    case 'INPUT_CHANGE':\n      let inputKey = payload.key, inputValue = payload.value;\n      return {\n        ...state,\n        values: { ...state.values, [inputKey]: inputValue },\n        touched: { ...state.touched, [inputKey]: true }\n      }\n    case 'VALIDATE_FORM':\n      let errors = payload.errors || {}\n      return {\n        ...state,\n        errors\n      }\n    case 'RESET_FORM':\n      return { ...payload, errors: {} }\n    case 'SUBMIT_FORM':\n      return { ...state, isSubmitted: true, submitCounter: ++state.submitCounter }\n    case 'CLEAR_FORM':\n      return { ...state, values: { ...payload.values }, errors: {} }\n    default:\n      return state;\n  }\n}\n\nconst defaultConfig = {\n  validate: true, //should validate form?\n  validationOnChange: false, //should form validate on blur input\n  validateSchema: false //yup validation schema\n}\n\nconst useForm = (initialValues = {}, config = { ...defaultConfig }) => {\n  let initalState = getInitialState(initialValues);\n  const [state, dispatch] = useReducer(reducer, initalState);\n  const { validate, validationOnChange, validateSchema } = config;\n\n  React.useEffect(() => {\n    async function checkForm() {\n      await validateForm();\n    }\n    if (validationOnChange && state.isSubmitted) {\n      checkForm();\n    }\n  }, [state.values, validationOnChange])\n\n  // React.useEffect(() => {\n  //   async function checkForm() {\n  //     if (await validateForm()) {\n  //       onSubmit();\n  //     }\n  //   }\n\n  //   state.isSubmitted && checkForm()\n  // }, [state.submitCounter, state.isSubmitted])\n\n  const validateForm = async () => {\n    let { isValid, errors } = await getValidationErrors();\n    dispatch({ type: 'VALIDATE_FORM', payload: { errors } });\n    return isValid;\n  }\n\n  const getValidationErrors = () => {\n    return new Promise((resolve, _) => {\n      if (validateSchema) {\n        try {\n          let isValid = validateSchema.validateSync(state.values, { abortEarly: false });\n          resolve({ isValid, errors: {} })\n        } catch (err) {\n          let errors = {};\n          err.inner.forEach((yupErr) => {\n            if (errors[yupErr.path]) {\n              errors[yupErr.path].push(yupErr.message);\n            } else {\n              errors[yupErr.path] = [yupErr.message];\n            }\n          });\n          resolve({ isValid: false, errors })\n        }\n      } else {\n        resolve({ isValid: true, errors: {} })\n      }\n    })\n  }\n\n  const handleChange = useCallback(async (key, value) => {\n    dispatch({\n      type: 'INPUT_CHANGE',\n      payload: { key, value }\n    });\n  })\n\n  const resetForm = useCallback(() => {\n    dispatch({\n      type: 'RESET_FORM',\n      payload: {\n        ...initalState\n      }\n    })\n  }, [initalState]);\n\n  const clearForm = useCallback(() => {\n    let oldValues = { ...state.values }\n    let values = Object.keys(oldValues).forEach(function (key) { oldValues[key] = \"\" });\n    dispatch({\n      type: 'CLEAR_FORM',\n      payload: {\n        ...values\n      }\n    })\n  })\n\n  const handleSubmit = useCallback(async (onSubmit) => {\n    if (validate) {\n      dispatch({ type: 'SUBMIT_FORM' })\n      if (await validateForm()) {\n        onSubmit();\n      }\n    } else {\n      onSubmit();\n    }\n  });\n\n  return { handleChange, resetForm, handleSubmit, clearForm, ...state }\n}\n\nexport default useForm;"],"names":["getInitialState","initialValues","values","errors","touched","isSubmitted","submitCounter","reducer","state","type","payload","inputKey","key","inputValue","value","defaultConfig","validate","validationOnChange","validateSchema","useForm","config","initalState","useReducer","dispatch","React","useEffect","checkForm","validateForm","getValidationErrors","isValid","Promise","resolve","_","validateSync","abortEarly","err","inner","forEach","yupErr","path","push","message","handleChange","useCallback","resetForm","clearForm","oldValues","Object","keys","handleSubmit","onSubmit"],"mappings":"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"}